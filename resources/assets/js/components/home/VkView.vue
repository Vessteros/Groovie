<template>
    <div class="vk-view-container" :class="{'vk-view-auth_form' : !showBanner}">
        <div v-if="showBanner" class="vk-view-banner" @click="checkUserAuth">
            <img class="vk-view-banner-img" src="http://vessteros.beget.tech/resources/img/views/vklogo.png">
        </div>

        <div v-else>
            <div v-if="!userAuthorized">
                <h3 class="auth-block-title">{{ networkTitle }}</h3>
                <a href="#" class="auth-block-close" @click="closeBanner">X</a>

                <p class="auth-block-vk_api_notice">
                    Web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ¬´Groovie¬ª —è–≤–ª—è–µ—Ç—Å—è "stand-alone" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º,
                    –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–∏–º –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –≤–∞—à–∏—Ö —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–ø—Ä–æ—â–µ–Ω–∏—è
                    –∂–∏–∑–Ω–∏ —Å–≤–æ–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
                    –í —Ç–æ–∂–µ –≤—Ä–µ–º—è –Ω–∞—à —Å–µ—Ä–≤–∏—Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∏ –≤ –∫–æ–µ–º —Å–ª—É—á–∞–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö –≤
                    —Å–≤–æ–∏—Ö —Ü–µ–ª—è—Ö –∏–ª–∏ –∫–∞–∫ –ª–∏–±–æ –µ—â–µ.
                    –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —Å—Ç—Ä–µ–º–∏—Ç—Å—è –æ–±–µ–∑–æ–ø–∞—Å–∏—Ç—å —Å–≤–æ–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –∫—Ä–∞–∂–∏
                    –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,
                    —Ç–∞–∫ –∏ –ø–æ–ª–∏—Ç–∏–∫–∞ <a href="https://vk.com/" target="_blank">vk.com</a> –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ
                    –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–±–æ—Ç—É —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å–æ —Å–≤–æ–∏–º API.
                    –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª—å–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è "stand-alone" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ¬´Groovie¬ª –Ω–µ–æ–±—Ö–æ–¥–∏–º
                    —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –ø—Ä–∏–≤–∏–ª–µ–≥–∏–µ–π –¥–æ—Å—Ç—É–ø–∞.
                    –ï—Å–ª–∏ –í—ã –ø–æ –∫–∞–∫–æ–π-–ª–∏–±–æ –ø—Ä–∏—á–∏–Ω–µ –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç–µ –Ω–∞—à–µ–º—É —Å–µ—Ä–≤–∏—Å—É –∏–ª–∏ –æ—á–µ–Ω—å –±–µ—Ä–µ–∂–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ —Å–≤–æ–∏–º
                    –ª–∏—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º, —Ç–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ ¬´Groovie¬ª
                    –í—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—à–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –í —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –≤—ã –≥–æ–ª–æ–≤—ã –ø–æ–π—Ç–∏ –Ω–∞ —Ä–∏—Å–∫ (üòè), —Ç–æ –ø–æ—Å–ª–µ
                    —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å <a href="https://vk.com/" target="_blank">vk.com</a> –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –≤–∞—Å –Ω–∞
                    —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ —Å–≤–æ–µ–º –¥–æ–º–µ–Ω–µ, –≤ url –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π
                    –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ –ø–æ–ª–µ –Ω–∏–∂–µ.
                    –ù–∞–ø–æ–º–∏–Ω–∞–µ–º –≤–∞–º, —á—Ç–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç—Å—è –æ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ —Å–≤–æ–µ–π –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∏, –µ—Å–ª–∏ —É –í–∞—Å –µ—Å—Ç—å
                    –∫–∞–∫–∏–µ-–ª–∏–±–æ —Å–æ–º–Ω–µ–Ω–∏—è, —Ç–æ —Å–æ–≤–µ—Ç—É–µ–º –æ—Å—Ç–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ —Å–µ—Ä–≤–∏—Å–µ <a href="https://vk.com/"
                                                                                       target="_blank">vk.com</a> —á–µ—Ä–µ–∑
                    –Ω–∞—à–µ web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ –º–æ–º–µ–Ω—Ç–∞, –∫–æ–≥–¥–∞ –í—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞—à–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:)
                </p>
                <div class="vk-view-auth_container">
                    <a v-bind:href="redirectUrl" class="auth-block-vk_auth" target="_blank">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</a>
                    <div class="auth-block-token_form" v-if="showTokenForm">
                        <input autocomplete="off" v-on:keyup.enter="setUserToken" v-model="apiUserToken"
                               class="form-control" name="token" placeholder="–ü—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω"/>
                    </div>
                    <div class="auth-block-token_form dark-banner" v-else @click="showTokenForm=true">
                        Token
                    </div>
                </div>
            </div>
            <div v-else>
                {{userInfo}}
                <a href="#" class="auth-block-close" @click="closeBanner">X</a>
            </div>
        </div>
    </div>
</template>

<script>
    export default {
        name: "Vk-view",

        data: function () {
            return {
                showBanner: true,
                showTokenForm: false,
                userAuthorized: false,
                networkTitle: '–í–ö–æ–Ω—Ç–∞–∫—Ç–µ',
                userInfo: {},
                redirectUrl: '',
                apiUserToken: '',
            }
        },

        methods: {
            closeBanner() {
                this.showBanner = true;
                this.showTokenForm = false;
                location.reload();
            },

            setUserToken() {
                axios({
                    method: 'post',
                    url: '/account/authorized/set',
                    data: {
                        networkId: 'vk',
                        apiUserToken: this.apiUserToken,
                    }
                })
                    .then((response) => {
                        console.log(response);
                        this.userInfo = response.data;
                        this.userAuthorized = true;
                    })
                    .catch((error) => {
                        if (error.response) {
                            console.log(0);
                            console.log(error.response);
                        } else if (error.request) {
                            console.log(1);
                            console.log(error.request);
                        } else {
                            console.log('Error', error.message);
                        }
                        console.log(error.config);
                    });
            },

            checkUserAuth() {
                axios({
                    method: 'post',
                    url: '/account/auth/check',
                    data: {
                        networkId: 'vk',
                    }
                })
                    .then((response) => {
                        console.log(response);
                        if (response.data.length !== 0)  {
                            this.showBanner = false;
                            this.userAuthorized = true;
                            this.userInfo = response.data;
                        } else {
                            this.authorization();
                        }
                    })
                    .catch((error) => {
                        if (error.response) {
                            console.log(0);
                            console.log(error.response);
                        } else if (error.request) {
                            console.log(1);
                            console.log(error.request);
                        } else {
                            console.log('Error', error.message);
                        }
                        console.log(error.config);
                    });
            },

            authorization() {
                this.showBanner = false;
                this.inputValue = '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...';

                axios({
                    method: 'post',
                    url: '/account/auth',
                    headers: {
                        'content-type': 'application/form-data',
                    },
                    data: {
                        networkId: 'vk',
                    }
                })
                    .then((response) => {
                        console.log(response);
                        this.redirectUrl = response.data;
                        this.showForm = true;
                    })
                    .catch((error) => {
                        if (error.response) {
                            console.log(0);
                            console.log(error.response);
                        } else if (error.request) {
                            console.log(1);
                            console.log(error.request);
                        } else {
                            console.log('Error', error.message);
                        }
                        console.log(error.config);
                    });
            },
        }
    }
</script>

<style scoped>
    .vk-view-container {
        display: block;
        float: left;
        width: 20vw;
        height: 20vw;
        cursor: pointer;
        background: #303540;
    }

    .vk-view-banner {
        background: #4c75a3;
        width: 100%;
        height: 100%;
    }

    .vk-view-banner-img {
        display: block;
        float: left;
        width: 10vw;
        height: 8vw;
        margin: 6vw 5vw auto 5vw;
    }

    .vk-view-auth_container {
        display: block;
        float: left;
        width: 30vw;
        height: 100%;
        margin-left: 3vw;
    }

    .vk-view-auth_form {
        display: block;
        float: left;
        width: 75vw;
        height: 80vh;
        margin: 0 12% auto 12%;
        overflow-y: auto;
    }
</style>